<!DOCTYPE html>
<html lang="es" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destapes de Alcantarillado 24/7 | Expertos de Confianza</title>
    <link rel="icon" href="/icono.ico" type="image/x-icon">
    <meta name="description"
        content="Servicio de destape de alcantarillado urgente en Chile. Atención 24/7 y trabajo 100% garantizado. Llegamos en minutos. ¡Llama o escribe por WhatsApp ahora!">
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <link href="/output.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap">
    </noscript>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            /* Fondo blanco/gris claro */
            color: #111827;
            /* Texto oscuro */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .gradient-text {
            background: linear-gradient(90deg, #2563eb, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .loader {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* --- NUEVO BOTÓN FLOTANTE DE WHATSAPP --- */
        .floating-whatsapp-btn {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background-color: #25d366;
            /* Verde WhatsApp */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 14px 0 rgba(0, 0, 0, 0.25);
            z-index: 100;
            animation: pulse-whatsapp 2s infinite;
            transition: transform 0.3s ease;
        }

        .floating-whatsapp-btn:hover {
            transform: scale(1.1);
            animation: none;
            /* Detiene la animación al pasar el mouse */
        }

        @keyframes pulse-whatsapp {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 12px rgba(37, 211, 102, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(37, 211, 102, 0);
            }
        }

        /* --- Estilos del Chatbot Integrado --- */
        .chat-opener {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: #2563eb;
            /* Azul de confianza */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 1000;
        }

        .chat-opener:hover {
            transform: scale(1.1);
            background: #1d4ed8;
        }

        .chat-window {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 90%;
            max-width: 400px;
            height: 70vh;
            max-height: 600px;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 1.5rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(20px) scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 999;
            pointer-events: none;
        }

        .chat-window.open {
            transform: translateY(0) scale(1);
            opacity: 1;
            pointer-events: auto;
        }

        .chat-opener.hidden {
            transform: scale(0);
            opacity: 0;
        }

        .chat-header {
            background-color: #f3f4f6;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #e5e7eb;
        }

        .chat-header-title {
            font-weight: 700;
            color: #111827;
        }

        .chat-close-btn {
            background: none;
            border: none;
            color: #6b7280;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .chat-bubble {
            max-width: 85%;
            padding: 0.6rem 1rem;
            border-radius: 1.25rem;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .user-bubble {
            background-color: #2563eb;
            color: white;
            border-bottom-right-radius: 0.375rem;
            align-self: flex-end;
        }

        .bot-bubble {
            background-color: #e5e7eb;
            color: #374151;
            border-bottom-left-radius: 0.375rem;
            align-self: flex-start;
        }

        .summary-notification {
            background-color: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
            border-radius: 0.5rem;
            padding: 1rem;
            font-size: 0.9em;
            text-align: left;
        }

        .chat-input-form {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem;
            border-top: 1px solid #e5e7eb;
            background-color: #f9fafb;
        }

        .chat-input {
            flex-grow: 1;
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 9999px;
            padding: 0.75rem 1rem;
            color: #111827;
            outline: none;
        }

        .chat-input:focus {
            border-color: #2563eb;
            ring: 1;
            ring-color: #2563eb;
        }

        .chat-send-btn {
            background-color: #2563eb;
            color: white;
            border-radius: 50%;
            padding: 0.75rem;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 50px;
            width: 50px;
        }

        .chat-send-btn:hover {
            background-color: #1d4ed8;
        }

        .chat-send-btn:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }

        #initial-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 1rem;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .initial-chat-btn {
            width: 100%;
            padding: 1rem;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1.125rem;
            cursor: pointer;
            border: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .initial-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        #emergency-btn {
            background-color: #ef4444;
            color: white;
        }

        #schedule-btn {
            background-color: #3b82f6;
            color: white;
        }
    </style>
</head>

<body class="bg-gray-50 text-gray-800">
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-gray-200">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-extrabold text-gray-900"
                aria-label="DestapeRápido - Ir a la página de inicio">

                <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="120px" height="100px"
                    viewBox="0 0 791.000000 566.000000" preserveAspectRatio="xMidYMid meet">

                    <g transform="translate(0.000000,566.000000) scale(0.100000,-0.100000)"
                        fill="rgb(37 99 235 / var(--tw-text-opacity, 1))" stroke="none">
                        <path
                            d="M2058 5526 c-106 -38 -186 -104 -232 -193 -16 -31 -16 -33 6 -47 13 -8 120 -56 238 -106 118 -51 228 -101 245 -113 16 -11 93 -71 170 -133 146 -116 195 -147 257 -158 49 -9 121 10 149 40 23 24 23 25 3 42 -10 10 -61 56 -112 102 -68 61 -91 88 -87 101 9 28 -14 186 -36 244 -40 107 -148 194 -285 229 -95 25 -234 21 -316 -8z" />
                        <path
                            d="M1774 5188 c-173 -206 -17 -569 276 -644 153 -39 322 23 410 151 54 78 52 85 -37 156 -112 89 -212 152 -426 268 -104 55 -190 101 -192 101 -2 0 -16 -15 -31 -32z" />
                        <path
                            d="M1175 4934 c-138 -35 -259 -106 -371 -218 -246 -247 -569 -764 -675 -1081 -24 -70 -24 -72 -27 -647 l-3 -577 -34 -11 -35 -12 0 -154 c0 -140 2 -154 18 -155 9 -1 22 -2 27 -4 6 -1 15 -3 21 -3 6 -1 9 -24 6 -63 -3 -37 0 -65 7 -72 7 -7 54 -11 124 -12 l112 0 6 -400 c7 -428 13 -493 64 -648 122 -375 409 -652 789 -761 182 -53 263 -57 1004 -53 742 4 724 3 890 67 322 124 519 406 541 774 l6 111 143 3 142 3 0 369 0 370 -297 0 c-325 0 -390 -8 -483 -55 -104 -53 -199 -163 -241 -281 -19 -52 -23 -89 -29 -319 -7 -277 -13 -309 -63 -364 -34 -37 -95 -61 -159 -61 -66 0 -82 15 -47 42 118 91 130 109 138 230 l6 87 -45 8 c-25 5 -92 8 -150 8 -101 0 -108 -1 -180 -37 -41 -21 -95 -49 -119 -63 -34 -19 -58 -25 -105 -25 -65 0 -82 6 -191 74 -124 76 -278 101 -450 71 -55 -9 -110 -21 -123 -26 -20 -8 -21 -11 -11 -31 41 -76 202 -184 330 -222 182 -53 147 -134 -44 -101 -193 33 -376 172 -462 350 -60 124 -65 161 -65 543 l0 342 110 0 c128 0 134 5 124 92 l-6 54 48 15 49 15 0 144 0 145 -41 9 -42 9 -5 166 c-7 231 -4 223 -223 576 -55 88 -114 185 -132 216 l-31 55 91 120 c49 65 95 128 100 140 7 14 4 40 -7 84 -35 136 -47 231 -52 425 -5 197 3 273 27 249 5 -5 16 -70 25 -144 30 -256 73 -485 104 -554 10 -22 35 -57 55 -76 l37 -35 349 0 c247 0 352 -3 360 -11 13 -13 56 -329 70 -519 14 -183 30 -365 35 -400 5 -28 2 -32 -30 -44 -42 -15 -52 -44 -32 -93 l15 -36 -47 -22 c-58 -27 -104 -69 -142 -128 -32 -50 -75 -170 -64 -180 3 -4 102 -9 218 -12 117 -3 218 -9 225 -13 34 -23 -2 -27 -226 -27 l-239 0 -11 -25 c-24 -52 -13 -89 32 -112 40 -22 365 -30 600 -15 186 12 209 21 214 89 2 33 -1 44 -22 60 -17 14 -26 34 -31 69 -24 160 -76 237 -198 289 -53 22 -66 32 -61 44 23 56 8 99 -36 107 -16 4 -30 7 -30 8 -11 100 -30 385 -30 447 l0 86 37 24 c48 32 76 89 81 165 5 71 -13 116 -56 138 -27 14 -29 13 -56 -20 -15 -19 -31 -34 -35 -34 -5 0 -17 34 -26 75 l-18 74 33 37 c18 21 39 54 48 73 21 50 21 177 -1 217 -18 35 -67 79 -97 89 -16 5 -20 15 -20 50 0 37 -5 48 -25 61 -39 26 -72 6 -87 -50 -9 -36 -18 -48 -40 -55 -15 -6 -39 -22 -53 -37 l-25 -27 -128 6 c-70 4 -144 10 -165 13 l-39 7 7 71 c3 39 15 139 27 221 27 198 22 322 -17 418 -35 86 -99 158 -173 193 -50 24 -71 28 -162 30 -58 2 -114 0 -125 -2z m-520 -1939 c15 -25 73 -110 127 -188 l98 -142 0 -80 c0 -44 -3 -104 -6 -132 l-7 -53 -128 0 -129 0 0 320 c0 176 4 320 8 320 4 0 21 -20 37 -45z m1817 -2102 c38 -34 8 -95 -47 -95 -35 0 -55 19 -55 53 0 50 64 77 102 42z m-391 -213 c23 -13 25 -53 3 -71 -13 -11 -20 -11 -42 2 -61 34 -23 102 39 69z" />
                        <path
                            d="M4594 4230 c-63 -13 -138 -55 -172 -95 -77 -95 -67 -255 23 -341 43 -42 67 -52 243 -104 87 -25 112 -47 112 -95 0 -69 -73 -108 -158 -86 -42 12 -82 51 -82 81 0 22 -37 30 -131 30 l-69 0 0 -32 c0 -92 60 -177 153 -219 45 -21 67 -24 172 -24 107 0 125 3 165 24 115 60 165 160 139 280 -22 103 -91 166 -220 200 -127 34 -187 65 -197 104 -5 18 -5 44 0 59 11 30 61 58 105 58 38 0 91 -34 106 -67 6 -16 16 -31 22 -35 14 -10 147 -10 163 1 29 18 -12 133 -65 183 -66 63 -209 99 -309 78z" />
                        <path
                            d="M2925 4208 c-3 -7 -4 -204 -3 -438 l3 -425 155 1 c193 0 282 18 369 74 72 46 120 109 152 199 20 55 24 84 23 171 -1 119 -16 175 -70 255 -86 129 -213 175 -487 175 -101 0 -139 -3 -142 -12z m356 -179 c51 -18 97 -55 122 -102 19 -35 22 -58 22 -142 0 -83 -4 -107 -22 -140 -43 -81 -108 -115 -219 -115 l-64 0 0 255 0 255 64 0 c34 0 78 -5 97 -11z" />
                        <path
                            d="M3760 3780 l0 -440 250 0 250 0 0 90 0 90 -155 0 -155 0 0 95 0 95 135 0 135 0 0 80 0 80 -135 0 -135 0 0 85 0 85 133 0 c188 0 178 -5 175 94 l-3 81 -247 3 -248 2 0 -440z" />
                        <path
                            d="M5052 4133 c2 -61 7 -88 16 -89 6 -1 57 -2 112 -3 l100 -1 0 -350 0 -350 95 0 95 0 0 350 c0 326 1 350 18 351 9 1 56 0 105 -1 l87 -2 0 91 0 91 -315 0 -316 0 3 -87z" />
                        <path
                            d="M5871 4033 c-121 -382 -211 -671 -211 -682 0 -7 34 -11 100 -11 l99 0 22 73 c12 39 26 77 31 84 10 12 267 16 287 4 6 -4 21 -40 33 -81 l24 -75 102 -3 c74 -2 102 1 102 9 0 20 -262 843 -273 857 -7 8 -46 12 -133 12 l-123 0 -60 -187z m223 -154 c19 -63 41 -138 49 -166 l15 -53 -99 0 c-54 0 -99 3 -99 8 -1 11 94 331 97 328 2 -1 18 -54 37 -117z" />
                        <path
                            d="M6552 3783 l3 -438 98 -3 97 -3 0 144 0 145 118 4 c102 4 124 8 168 31 93 47 144 137 144 252 0 160 -98 267 -270 295 -36 5 -131 10 -213 10 l-147 0 2 -437z m327 248 c83 -16 123 -96 86 -174 -22 -47 -66 -67 -149 -67 l-66 0 0 125 0 125 43 0 c23 -1 62 -5 86 -9z" />
                        <path
                            d="M7295 4208 c-3 -7 -4 -204 -3 -438 l3 -425 248 -3 247 -2 0 90 0 90 -150 0 -150 0 0 95 0 95 136 0 135 0 -2 80 -2 80 -134 0 -134 0 3 87 3 87 148 -3 147 -3 0 91 0 91 -245 0 c-187 0 -247 -3 -250 -12z" />
                        <path
                            d="M1392 3558 c13 -10 66 -36 118 -59 52 -22 200 -88 328 -146 128 -58 235 -103 239 -100 3 4 -6 71 -21 151 l-28 143 -91 7 c-51 3 -175 8 -277 12 -102 3 -209 7 -238 8 -52 2 -53 2 -30 -16z" />
                        <path
                            d="M4085 3160 c-25 -49 -45 -92 -45 -95 0 -3 44 -4 98 -3 l97 3 58 85 c68 100 69 98 -70 99 l-93 1 -45 -90z" />
                        <path
                            d="M7235 3020 c-247 -51 -401 -268 -381 -538 19 -263 185 -443 430 -468 232 -23 445 133 501 367 44 190 -6 392 -129 515 -107 106 -271 154 -421 124z m196 -221 c88 -44 143 -150 142 -274 -1 -87 -14 -137 -52 -197 -42 -66 -98 -101 -171 -106 -74 -5 -123 11 -176 60 -66 61 -89 123 -89 243 0 89 3 106 26 150 33 61 66 98 110 121 68 36 143 37 210 3z" />
                        <path
                            d="M2924 2995 c-2 -5 -3 -225 -2 -488 l3 -478 108 -2 107 -2 0 163 0 162 51 0 50 0 76 -157 c41 -87 77 -160 80 -163 2 -2 60 -5 129 -5 106 -1 124 1 119 14 -3 8 -46 89 -96 180 -50 90 -86 167 -81 170 124 80 169 168 159 310 -12 177 -103 271 -292 301 -84 14 -406 10 -411 -5z m397 -195 c57 -16 82 -51 87 -119 4 -56 2 -61 -31 -97 l-35 -38 -97 -6 c-53 -3 -99 -3 -101 -1 -2 2 -4 64 -4 138 l0 133 73 0 c39 0 88 -5 108 -10z" />
                        <path
                            d="M4723 3004 c-20 -9 -19 -960 1 -971 8 -4 58 -7 110 -5 l96 3 0 154 0 153 128 4 c152 6 219 27 281 89 67 67 86 118 86 229 0 135 -40 219 -132 278 -85 54 -137 64 -358 68 -110 2 -206 1 -212 -2z m414 -217 c42 -22 64 -66 65 -128 0 -57 -18 -91 -65 -119 -25 -16 -50 -20 -119 -20 l-88 0 0 146 0 146 88 -4 c55 -3 99 -11 119 -21z" />
                        <path
                            d="M5568 3002 c-17 -3 -18 -35 -18 -487 0 -377 3 -484 13 -487 9 -4 134 -2 200 2 4 0 7 218 7 485 0 267 -3 485 -7 486 -24 3 -181 4 -195 1z" />
                        <path
                            d="M5958 3003 c-17 -4 -18 -36 -18 -492 l0 -487 183 3 c222 3 298 15 385 59 171 85 251 244 240 472 -14 259 -164 411 -437 442 -86 10 -320 12 -353 3z m399 -209 c105 -29 161 -109 170 -242 10 -139 -40 -247 -134 -293 -37 -18 -70 -24 -140 -27 l-93 -4 0 290 c0 211 3 291 12 294 21 7 133 -3 185 -18z" />
                        <path
                            d="M4017 2983 c-9 -15 -297 -928 -297 -941 0 -9 29 -12 110 -12 l109 0 27 85 26 85 169 0 168 0 27 -85 26 -85 114 0 c65 0 114 4 114 9 0 9 -48 163 -249 796 l-48 150 -146 3 c-80 1 -148 -1 -150 -5z m203 -408 c28 -99 53 -186 55 -192 3 -10 -24 -13 -114 -13 l-119 0 38 123 c21 67 48 155 60 195 12 41 23 72 25 70 2 -1 26 -84 55 -183z" />
                        <path
                            d="M2264 1812 c-19 -12 -61 -104 -73 -160 -30 -144 13 -296 56 -194 21 51 53 233 53 304 0 57 -8 69 -36 50z" />
                        <path
                            d="M4040 1635 l0 -107 238 6 c130 3 476 11 767 16 921 17 1449 32 1472 41 58 22 52 105 -8 125 -24 9 -385 14 -1251 19 l-1218 8 0 -108z" />
                        <path
                            d="M2585 1661 c-83 -37 -173 -170 -197 -288 -8 -40 -8 -56 2 -68 11 -13 16 -9 40 28 33 53 66 77 163 122 86 40 122 67 142 105 21 41 19 67 -10 95 -30 31 -82 33 -140 6z" />
                        <path
                            d="M1904 1565 c-12 -18 -14 -33 -8 -52 8 -26 9 -25 12 15 4 58 17 53 19 -8 1 -29 -2 -48 -8 -45 -5 3 -6 -1 -3 -9 5 -14 9 -14 34 -1 26 14 28 13 32 -10 3 -13 2 -23 -2 -22 -5 1 -8 -2 -9 -8 -1 -5 15 -9 34 -9 29 0 37 -4 41 -22 3 -13 3 -28 -2 -35 -4 -8 -3 -9 4 -5 15 9 16 105 1 143 -5 15 -24 43 -42 61 -39 40 -79 43 -103 7z m90 -6 c28 -22 27 -42 -2 -32 -29 10 -56 53 -33 53 4 0 20 -9 35 -21z m48 -98 c2 -17 1 -28 -4 -25 -8 5 -12 54 -4 54 2 0 6 -13 8 -29z" />
                        <path d="M1990 1406 c0 -2 8 -10 18 -17 15 -13 16 -12 3 4 -13 16 -21 21 -21 13z" />
                        <path
                            d="M4050 1290 c0 -71 3 -92 15 -96 8 -3 239 -1 512 5 274 7 684 16 912 21 460 10 461 10 461 74 0 21 -8 40 -21 52 -20 18 -48 19 -518 25 -273 4 -691 7 -928 8 l-433 1 0 -90z" />
                        <path
                            d="M2153 1268 c-32 -15 -57 -72 -46 -105 8 -22 15 -26 56 -28 39 -1 48 2 53 18 11 35 12 52 2 69 -8 16 -11 16 -43 1 -28 -13 -35 -23 -35 -44 0 -35 -16 -46 -23 -17 -9 32 18 87 49 98 53 20 91 -29 82 -104 -2 -19 0 -32 4 -30 4 3 8 27 8 53 0 37 -6 54 -25 75 -26 28 -46 31 -82 14z" />
                        <path
                            d="M2550 1230 c-21 -21 -26 -55 -10 -65 6 -3 10 -2 10 3 0 6 14 7 35 2 29 -7 35 -5 40 11 8 23 -3 59 -17 59 -7 0 -6 -5 1 -14 7 -8 8 -17 3 -20 -13 -8 -35 20 -27 34 11 18 -14 11 -35 -10z m20 -7 c0 -14 -19 -38 -25 -32 -8 8 5 39 16 39 5 0 9 -3 9 -7z" />
                        <path d="M2578 1153 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z" />
                        <path
                            d="M4050 931 l0 -101 48 0 c26 0 202 5 392 10 850 23 813 21 843 47 21 19 22 72 3 99 -13 17 -31 20 -178 25 -89 3 -327 6 -528 7 -201 2 -413 5 -472 8 l-108 5 0 -100z" />
                    </g>
                </svg>

            </a>
            <div class="hidden md:flex space-x-8 text-gray-600 font-medium items-center">
                <a href="#servicios" class="hover:text-blue-600 transition-colors">Nuestros Servicios</a>
                <a href="#garantia" class="hover:text-blue-600 transition-colors">Garantía</a>
                <a href="#contacto" class="hover:text-blue-600 transition-colors">Contacto Urgente</a>
            </div>
            <a href="https://wa.me/569XXXXXXXX?text=Hola,%20necesito%20un%20destape%20de%20alcantarillado%20urgente."
                target="_blank"
                class="bg-green-700 text-white font-bold py-2 px-5 rounded-full hover:bg-green-600 transition-all duration-300 flex items-center space-x-2 shadow-lg shadow-green-500/20 transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 175.216 175.552" width="30px" height="30px">
                    <script xmlns="" id="eppiocemhmnlbhjplcgkofciiegomcon" />
                    <script xmlns="" />
                    <script xmlns="" />
                    <defs>
                        <linearGradient id="b" x1="85.915" x2="86.535" y1="32.567" y2="137.092"
                            gradientUnits="userSpaceOnUse">
                            <stop offset="0" stop-color="#57d163" />
                            <stop offset="1" stop-color="#23b33a" />
                        </linearGradient>
                        <filter id="a" width="1.115" height="1.114" x="-.057" y="-.057"
                            color-interpolation-filters="sRGB">
                            <feGaussianBlur stdDeviation="3.531" />
                        </filter>
                    </defs>
                    <path fill="#b3b3b3"
                        d="m54.532 138.45 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.523h.023c33.707 0 61.139-27.426 61.153-61.135.006-16.335-6.349-31.696-17.895-43.251A60.75 60.75 0 0 0 87.94 25.983c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.558zm-40.811 23.544L24.16 123.88c-6.438-11.154-9.825-23.808-9.821-36.772.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954zm0 0"
                        filter="url(#a)" />
                    <path fill="#fff"
                        d="m12.966 161.238 10.439-38.114a73.42 73.42 0 0 1-9.821-36.772c.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954z" />
                    <path fill="url(#linearGradient1780)"
                        d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.559 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.524h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.929z" />
                    <path fill="url(#b)"
                        d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.313-6.179 22.558 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.517 31.126 8.523h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.928z" />
                    <path fill="#fff" fill-rule="evenodd"
                        d="M68.772 55.603c-1.378-3.061-2.828-3.123-4.137-3.176l-3.524-.043c-1.226 0-3.218.46-4.902 2.3s-6.435 6.287-6.435 15.332 6.588 17.785 7.506 19.013 12.718 20.381 31.405 27.75c15.529 6.124 18.689 4.906 22.061 4.6s10.877-4.447 12.408-8.74 1.532-7.971 1.073-8.74-1.685-1.226-3.525-2.146-10.877-5.367-12.562-5.981-2.91-.919-4.137.921-4.746 5.979-5.819 7.206-2.144 1.381-3.984.462-7.76-2.861-14.784-9.124c-5.465-4.873-9.154-10.891-10.228-12.73s-.114-2.835.808-3.751c.825-.824 1.838-2.147 2.759-3.22s1.224-1.84 1.836-3.065.307-2.301-.153-3.22-4.032-10.011-5.666-13.647" />
                </svg> <span>+56930153632</span>
            </a>
        </nav>
    </header>

    <main>
        <section id="hero" class="bg-white">
            <div class="container mx-auto px-6 py-20 md:py-32 text-center">
                <h1 class="text-4xl sm:text-5xl md:text-7xl font-extrabold text-gray-900 leading-tight tracking-tight">
                    ¿Emergencia de Tubería? <br> <span class="gradient-text">Solución Rápida y Garantizada.</span></h1>
                <p class="mt-6 text-base sm:text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">Somos el equipo de
                    expertos en destapes que responde a tu llamado 24/7. Tu tranquilidad es nuestra prioridad.</p>
                <div class="mt-8 flex flex-col sm:flex-row justify-center items-center gap-4">
                    <a href="tel:+56930153632"
                        class="w-full sm:w-auto inline-block bg-blue-600 text-white font-bold py-4 px-10 rounded-full hover:bg-blue-700 transition-colors text-lg shadow-lg shadow-blue-500/30 transform hover:scale-105">
                        LLAMAR PARA EMERGENCIA <br><small>+56930153632</small>
                    </a>
                </div>
                <p class="mt-4 text-sm text-gray-500">Atención inmediata 24 horas, 7 días a la semana.</p>
            </div>
        </section>

        <!-- SECCIÓN DE PRUEBA SOCIAL: GATILLO DE CONFIANZA -->
        <section class="bg-gray-100 py-12 fade-in-section">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
                    <div class="border-r border-gray-200">
                        <p class="text-3xl md:text-4xl font-bold text-blue-600">24/7</p>
                        <p class="text-sm text-gray-600">Disponibilidad Total</p>
                    </div>
                    <div class="border-r border-gray-200">
                        <p class="text-3xl md:text-4xl font-bold text-blue-600">100%</p>
                        <p class="text-sm text-gray-600">Trabajo Garantizado</p>
                    </div>
                    <div class="border-r border-gray-200">
                        <p class="text-3xl md:text-4xl font-bold text-blue-600">+500</p>
                        <p class="text-sm text-gray-600">Clientes Satisfechos</p>
                    </div>
                    <div>
                        <p class="text-3xl md:text-4xl font-bold text-blue-600">&lt;1 Hora</p>
                        <p class="text-sm text-gray-600">Tiempo de Respuesta*</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="garantia" class="py-16 md:py-24 bg-white fade-in-section">
            <div class="container mx-auto px-6">
                <div class="grid lg:grid-cols-2 gap-12 items-center">
                    <!-- SECCIÓN DE AUTORIDAD Y CONFIANZA -->
                    <div class="text-center lg:text-left">
                        <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">Deje su Problema en Manos
                            de <span class="gradient-text">Verdaderos Expertos</span></h2>
                        <p class="mt-4 text-lg text-gray-600 max-w-lg mx-auto lg:mx-0">No arriesgue su hogar con
                            novatos. Nuestro equipo combina años de experiencia con la mejor tecnología para dar una
                            solución definitiva y limpia.</p>
                        <ul class="mt-6 space-y-4 text-gray-700 text-left max-w-md mx-auto lg:mx-0">
                            <li class="flex items-start"><span
                                    class="flex-shrink-0 h-6 w-6 text-green-500 mr-3">✓</span>
                                <div><strong class="text-gray-900">Trabajo 100% Garantizado:</strong> No consideramos el
                                    trabajo terminado hasta que usted esté completamente satisfecho.</div>
                            </li>
                            <li class="flex items-start"><span
                                    class="flex-shrink-0 h-6 w-6 text-green-500 mr-3">✓</span>
                                <div><strong class="text-gray-900">Técnicos Certificados:</strong> Personal uniformado,
                                    profesional y de total confianza.</div>
                            </li>
                            <li class="flex items-start"><span
                                    class="flex-shrink-0 h-6 w-6 text-green-500 mr-3">✓</span>
                                <div><strong class="text-gray-900">Presupuesto Transparente:</strong> Sin costos ocultos
                                    ni sorpresas. Sabrá el valor antes de empezar.</div>
                            </li>
                        </ul>
                    </div>
                    <!-- IMAGEN HUMANA Y PROFESIONAL -->
                    <div class="p-4 rounded-xl bg-gray-100 border border-gray-200 shadow-xl w-full max-w-md mx-auto">
                        <img width="381" height="581" src="/destape-de-alcantarilla.webp"
                            alt="Técnico profesional de destapes sonriendo con confianza"
                            class="rounded-lg object-cover" loading="lazy">
                    </div>
                </div>
            </div>
        </section>

        <section id="servicios" class="py-16 md:py-20 bg-gray-50 fade-in-section">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-bold text-gray-900">Solucionamos Todo Tipo de Destapes</h2>
                    <p class="mt-3 text-gray-600 max-w-2xl mx-auto">Desde un simple lavaplatos hasta complejas redes de
                        alcantarillado, tenemos la solución.</p>
                </div>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 max-w-6xl mx-auto">
                    <div
                        class="bg-white p-8 rounded-xl border border-gray-200 text-center shadow-md transition-all duration-300 hover:shadow-xl hover:scale-105">
                        <div class="text-4xl mb-4 text-blue-600">🏠</div>
                        <h3 class="text-xl font-bold text-gray-900">Destapes Domésticos</h3>
                        <p class="text-gray-600 mt-2">WC, lavaplatos, duchas, tinas y desagües de lavadoras.</p>
                    </div>
                    <div
                        class="bg-white p-8 rounded-xl border-2 border-blue-600 text-center shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105">
                        <div class="text-4xl mb-4 text-blue-600">🏢</div>
                        <h3 class="text-xl font-bold text-gray-900">Edificios y Condominios</h3>
                        <p class="text-gray-600 mt-2">Mantención y destape de verticales y redes de alcantarillado.</p>
                    </div>
                    <div
                        class="bg-white p-8 rounded-xl border border-gray-200 text-center shadow-md transition-all duration-300 hover:shadow-xl hover:scale-105">
                        <div class="text-4xl mb-4 text-blue-600">📹</div>
                        <h3 class="text-xl font-bold text-gray-900">Inspección con Cámara</h3>
                        <p class="text-gray-600 mt-2">Detectamos la causa exacta del problema sin romper.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="social-proof-testimonials" class="py-16 md:py-24 bg-white fade-in-section">
            <div class="container mx-auto px-6 max-w-5xl">
                <div class="text-center mb-12">
                    <h2 class="text-3xl sm:text-4xl font-bold text-gray-900">Nuestros Clientes Confían en Nosotros</h2>
                </div>
                <div class="grid lg:grid-cols-2 gap-8">
                    <div class="bg-gray-100 border-l-4 border-blue-500 p-8 rounded-r-lg">
                        <p class="text-lg italic text-gray-700">"Tenía el baño inundado un domingo por la noche. Los
                            llamé y en menos de una hora ya estaban aquí. ¡Un servicio increíblemente rápido y
                            profesional! Los recomiendo 100%."</p>
                        <p class="mt-4 font-bold text-gray-900">— Javiera Rojas</p>
                        <p class="text-sm text-gray-600">Cliente Satisfecha, Santiago</p>
                    </div>
                    <div class="bg-gray-100 border-l-4 border-blue-500 p-8 rounded-r-lg">
                        <p class="text-lg italic text-gray-700">"Excelente servicio. Fueron muy transparentes con el
                            precio desde el principio y el técnico fue muy amable y limpio para trabajar. Se nota que
                            son profesionales."</p>
                        <p class="mt-4 font-bold text-gray-900">— Carlos Soto</p>
                        <p class="text-sm text-gray-600">Administrador de Condominio</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contacto" class="py-16 md:py-24 bg-gray-100 fade-in-section">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold text-gray-900">¿Necesita Ayuda Urgente? <br> <span
                        class="gradient-text">Hablemos Ahora</span></h2>
                <p class="mt-4 text-gray-600 max-w-2xl mx-auto">Rellene el formulario para una respuesta inmediata o use
                    los botones para un contacto directo. Estamos listos para ayudar.</p>

                <div class="bg-white border border-gray-200 rounded-2xl p-8 max-w-lg w-full mx-auto mt-8 shadow-2xl">
                    <form id="contact-form" novalidate>
                        <div class="mb-4">
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-2 text-left">Su
                                Nombre</label>
                            <input type="text" id="name" name="name" required
                                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder-gray-400">
                        </div>
                        <div class="mb-6">
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2 text-left">Su
                                Teléfono (para llamarle de vuelta)</label>
                            <input type="tel" id="phone" name="phone" required
                                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder-gray-400">
                        </div>
                        <div class="mb-6">
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2 text-left">Su Correo
                                (Opcional)</label>
                            <input type="email" id="email" name="email"
                                class="w-full p-3 bg-gray-50 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 text-gray-900 placeholder-gray-400">
                        </div>
                        <button type="submit"
                            class="w-full bg-orange-500 text-white font-bold py-4 rounded-lg hover:bg-orange-600 transition-colors text-lg shadow-lg shadow-orange-500/30">
                            SÍ, NECESITO UN DESTAPE URGENTE
                        </button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-gray-300 py-8">
        <div class="container mx-auto px-6 text-center text-sm">
            <p class="font-bold text-white text-lg mb-2">DestapeRapido.cl</p>
            <p>&copy; 2025 Todos los derechos reservados.</p>
            <p>Servicio de Emergencia en la Región Metropolitana.</p>
        </div>
    </footer>

    <!-- BOTÓN DE WHATSAPP FLOTANTE -->
    <a href="https://wa.me/56930153632?text=Hola,%20necesito%20un%20destape%20de%20alcantarillado%20urgente."
        target="_blank" class="floating-whatsapp-btn" aria-label="Contactar por WhatsApp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 175.216 175.552" width="30px" height="30px">
            <script xmlns="" id="eppiocemhmnlbhjplcgkofciiegomcon" />
            <script xmlns="" />
            <script xmlns="" />
            <defs>
                <linearGradient id="b" x1="85.915" x2="86.535" y1="32.567" y2="137.092" gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#57d163" />
                    <stop offset="1" stop-color="#23b33a" />
                </linearGradient>
                <filter id="a" width="1.115" height="1.114" x="-.057" y="-.057" color-interpolation-filters="sRGB">
                    <feGaussianBlur stdDeviation="3.531" />
                </filter>
            </defs>
            <path fill="#b3b3b3"
                d="m54.532 138.45 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.523h.023c33.707 0 61.139-27.426 61.153-61.135.006-16.335-6.349-31.696-17.895-43.251A60.75 60.75 0 0 0 87.94 25.983c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.558zm-40.811 23.544L24.16 123.88c-6.438-11.154-9.825-23.808-9.821-36.772.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954zm0 0"
                filter="url(#a)" />
            <path fill="#fff"
                d="m12.966 161.238 10.439-38.114a73.42 73.42 0 0 1-9.821-36.772c.017-40.556 33.021-73.55 73.578-73.55 19.681.01 38.154 7.669 52.047 21.572s21.537 32.383 21.53 52.037c-.018 40.553-33.027 73.553-73.578 73.553h-.032c-12.313-.005-24.412-3.094-35.159-8.954z" />
            <path fill="url(#linearGradient1780)"
                d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.312-6.179 22.559 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.518 31.126 8.524h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.929z" />
            <path fill="url(#b)"
                d="M87.184 25.227c-33.733 0-61.166 27.423-61.178 61.13a60.98 60.98 0 0 0 9.349 32.535l1.455 2.313-6.179 22.558 23.146-6.069 2.235 1.324c9.387 5.571 20.15 8.517 31.126 8.523h.023c33.707 0 61.14-27.426 61.153-61.135a60.75 60.75 0 0 0-17.895-43.251 60.75 60.75 0 0 0-43.235-17.928z" />
            <path fill="#fff" fill-rule="evenodd"
                d="M68.772 55.603c-1.378-3.061-2.828-3.123-4.137-3.176l-3.524-.043c-1.226 0-3.218.46-4.902 2.3s-6.435 6.287-6.435 15.332 6.588 17.785 7.506 19.013 12.718 20.381 31.405 27.75c15.529 6.124 18.689 4.906 22.061 4.6s10.877-4.447 12.408-8.74 1.532-7.971 1.073-8.74-1.685-1.226-3.525-2.146-10.877-5.367-12.562-5.981-2.91-.919-4.137.921-4.746 5.979-5.819 7.206-2.144 1.381-3.984.462-7.76-2.861-14.784-9.124c-5.465-4.873-9.154-10.891-10.228-12.73s-.114-2.835.808-3.751c.825-.824 1.838-2.147 2.759-3.22s1.224-1.84 1.836-3.065.307-2.301-.153-3.22-4.032-10.011-5.666-13.647" />
        </svg>
    </a>

    <!-- Contenedor del Chatbot Funcional -->
    <div id="chat-opener" class="chat-opener">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
            </path>
        </svg>
    </div>

    <div id="chat-window" class="chat-window">
        <div class="chat-header">
            <span class="chat-header-title">Asistente de Emergencia</span>
            <button id="chat-close-btn" class="chat-close-btn">&times;</button>
        </div>
        <div id="chat-messages" class="chat-messages">
            <div id="initial-buttons-container">
                <button id="emergency-btn" class="initial-chat-btn">
                    Tengo una Emergencia
                </button>
                <button id="schedule-btn" class="initial-chat-btn">
                    Quiero Agendar una Visita
                </button>
            </div>
        </div>
        <form id="chat-form" class="chat-input-form">
            <input type="text" id="user-input" placeholder="Escriba su nombre aquí..." class="chat-input"
                autocomplete="off">
            <button maxlength="100" type="submit" id="send-button" class="chat-send-btn" aria-label="Enviar mensaje" width="50px"
                height="50px">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </form>
    </div>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            // --- Lógica de Animación de Scroll ---
            const faders = document.querySelectorAll('.fade-in-section');
            const appearOptions = { threshold: 0.1, rootMargin: "0px 0px -50px 0px" };
            const appearOnScroll = new IntersectionObserver(function (entries, appearOnScroll) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                        appearOnScroll.unobserve(entry.target);
                    }
                });
            }, appearOptions);
            faders.forEach(fader => appearOnScroll.observe(fader));

            // --- LÓGICA DEL FORMULARIO DE CONTACTO PRINCIPAL ---
            const contactForm = document.getElementById('contact-form');

            contactForm.addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevenimos el envío para manejarlo con JS

                const nameInput = document.getElementById('name');
                const phoneInput = document.getElementById('phone');
                const emailInput = document.getElementById('email');

                // --- VALIDACIÓN ---
                // Reseteamos estilos de error por si acaso
                nameInput.classList.remove('border-red-500');
                phoneInput.classList.remove('border-red-500');

                // Verificamos si los campos requeridos están vacíos
                if (!nameInput.value.trim() || !phoneInput.value.trim()) {
                    alert('Por favor, complete su nombre y teléfono. Son campos obligatorios.');
                    // Opcional: Marcar los campos vacíos con un borde rojo
                    if (!nameInput.value.trim()) {
                        nameInput.classList.add('border-red-500');
                    }
                    if (!phoneInput.value.trim()) {
                        phoneInput.classList.add('border-red-500');
                    }
                    return; // Detenemos la ejecución si la validación falla
                }

                // Si la validación pasa, continuamos con el envío
                const submitButton = contactForm.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = '<div class="loader mx-auto"></div>';

                try {
                    const response = await fetch('/api/send-contact-form', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name: nameInput.value,
                            email: emailInput.value,
                            phone: phoneInput.value
                        }),
                    });

                    if (!response.ok) throw new Error('Falló el envío del formulario');

                    alert(`¡Gracias ${nameInput.value}! Hemos recibido su solicitud y le contactaremos a la brevedad posible.`);
                    contactForm.reset();

                } catch (error) {
                    console.error('Error en el formulario de contacto:', error);
                    alert('Lo sentimos, ocurrió un error. Por favor, llámenos o escríbanos por WhatsApp.');
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                }
            });

            // --- LÓGICA DEL CHATBOT ---
            const chatOpener = document.getElementById('chat-opener');
            const chatWindow = document.getElementById('chat-window');
            const closeChatBtn = document.getElementById('chat-close-btn');

            const openChat = () => {
                chatWindow.classList.add('open');
                chatOpener.classList.add('hidden');
            };
            const closeChat = () => {
                chatWindow.classList.remove('open');
                chatOpener.classList.remove('hidden');
            };
            chatOpener.addEventListener('click', openChat);
            closeChatBtn.addEventListener('click', closeChat);

            // --- LÓGICA CONVERSACIONAL DEL CHATBOT ---
            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const chatMessages = document.getElementById('chat-messages');
            const sendButton = document.getElementById('send-button');

            let conversationHistory = [];
            let conversationEnded = false;

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                if (conversationEnded) return;
                const userMessage = userInput.value.trim();
                if (!userMessage) return;

                appendMessage(userMessage, 'user');
                conversationHistory.push({ role: 'user', parts: [{ text: userMessage }] });
                userInput.value = '';
                userInput.focus();
                toggleLoading(true);

                try {
                    const botResponse = await getBotResponse();
                    appendMessage(botResponse, 'bot');
                    conversationHistory.push({ role: 'model', parts: [{ text: botResponse }] });
                    
                    let flowType = null;

            
                    const lowerCaseResponse = botResponse.toLowerCase();

                    if (lowerCaseResponse.includes("un técnico le llamará en minutos")) {
                        flowType = 'emergency';
                    } else if (lowerCaseResponse.includes("agendado") && lowerCaseResponse.includes("registramos su visita")) {
                        flowType = 'schedule';
                    }

                    if (flowType) {
                        console.log(`FRONTEND: Condición de cierre detectada para '${flowType}'.`);
                        conversationEnded = true;
                        userInput.disabled = true;
                        userInput.placeholder = "Conversación finalizada.";
                        await triggerSummaryGeneration(flowType); // Se pasa el tipo de flujo
                    }

                } catch (error) {
                    console.error("Error obteniendo respuesta del bot:", error);
                    appendMessage("Lo siento, algo salió mal. Por favor, llámenos directamente.", 'bot');
                } finally {
                    toggleLoading(false);
                }
            });
            function appendMessage(message, sender, type = 'bubble') {
                const messageDiv = document.createElement('div');
                if (type === 'bubble') {
                    messageDiv.classList.add('chat-bubble', sender === 'user' ? 'user-bubble' : 'bot-bubble');
                    messageDiv.textContent = message;
                } else if (type === 'summary') {
                    messageDiv.classList.add('summary-notification');
                    messageDiv.innerHTML = message;
                }
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            function toggleLoading(isLoading) {
                const sendIcon = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>`;
                sendButton.disabled = isLoading;
                sendButton.innerHTML = isLoading ? `<div class="loader"></div>` : sendIcon;
            }
            async function callGemini(payload) {
                // This assumes you have an API endpoint at '/api/chat'
                const apiUrl = '/api/chat';
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    const errorDetails = await response.text();
                    throw new Error(`Error en la API: ${response.status}. Detalles: ${errorDetails}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text.trim();
                } else {
                    return "No he podido procesar eso. ¿Podemos intentarlo de nuevo?";
                }
            }
            async function getBotResponse() {
                const systemInstructionText = `
                **Tu Rol (Persona):** Eres un "Asistente de Servicios" para "Destaperapido.cl", una empresa de destape de alcantarillados y más. Eres bilingüe: extremadamente rápido y directo para emergencias, pero también amable y detallista para agendar visitas. Tu misión es reaccionar a la elección inicial del cliente (emergencia o agendamiento) y guiarlo por el camino correcto, utilizando la **"Base de Conocimiento"** para responder cualquier pregunta que surja.

                ---
                ### Base de Conocimiento (Tu Cerebro) ###

                * **Cobertura:** Toda la Región Metropolitana.
                * **Precios:** El servicio comienza desde los $70.000 pesos chilenos. El valor final depende de la complejidad del trabajo y se confirma en terreno.
                * **Contacto Directo:** Si lo preguntan, el número de teléfono y WhatsApp es +56930153632.
                * **Horarios:** Atención de emergencias 24/7.
                * **Métodos de Pago:** Aceptamos efectivo, transferencia y tarjetas de crédito/débito.
                * **Garantía del Servicio:** Sí, todos nuestros trabajos tienen una garantía de 3 meses (la duración exacta puede variar según el servicio realizado).
                * **Tipos de Servicios:** Realizamos todo tipo de destapes: WC, lavaplatos, desagües, verticales de edificios y también ofrecemos inspección con cámara.
                * **Diferenciadores Clave:** Somos los más rápidos de Santiago. Usamos maquinaria moderna que no daña sus tuberías, trabajamos de forma limpia y nuestros técnicos están certificados.
                ---

                **Flujo de EMERGENCIA (se activa si el usuario elige "Tengo una Emergencia"):**

                1.  **Tu primera respuesta debe ser:** "Entendido. Para enviar un técnico ya, ¿cuál es su **teléfono**?"
                2.  **Valida en numero de telefono si es correcto (debe ser Chileno) con +569XXXXXXXX O 569XXXXXXXX O 9XXXXXXXX O XXXXXXXX **".
                2.  **Luego, pide la Comuna:** "Ok. ¿Y en qué **comuna** se encuentra?".
                3.  **Luego, pide el Nombre:** "Perfecto, tenemos cobertura. ¿A nombre de quién?".
                4.  **Cierre y Despacho:** Al tener los datos, USA LA FRASE EXACTA: "¡Listo, [Nombre]! Un técnico le llamará en minutos al [Número de Teléfono]. La ayuda para [Comuna] va en camino. ¿Tiene alguna otra duda?".
 
                ---
                **Flujo de AGENDAMIENTO (se activa si el usuario elige "Quiero Agendar"):**

                1.  **Tu primera respuesta debe ser:** "Excelente. Para que el técnico vaya preparado, descríbame brevemente el problema.".
                2.  **Luego, pide Datos Logísticos:**
                    * Si es posible, decír alguna pequeña broma para subir el animo por el problema dado, y pedí dirección y comuna, en caso de que no "Gracias por el detalle. Para continuar, ¿cuál es la **dirección y comuna**?"
                    * "Perfecto. ¿Y su **número de teléfono** para confirmar la visita?"
                3.  **Luego, pide el Nombre:** "Gracias. Por último, ¿a nombre de quién agendamos?".
                4.  **Luego, coordina el Horario:** "¡Muy bien, [Nombre]! Ya tengo sus datos. ¿Qué día y horario le acomoda más?".
                5.  **Cierre y Confirmación:** Al tener el horario, USA LA FRASE EXACTA: "¡Agendado! Registramos su visita para [Dirección]. Un técnico le llamará al [Teléfono] para confirmar el horario. ¡Que tenga un buen día!".

                ---
                **Reglas Globales:**
                * **¡Prioridad a la Brevedad!:** Tus respuestas deben ser cortas y directas.
                * **No seas repetitivo:** No vuelvas a presentarte como un asistente.
                * **Usa la Base de Conocimiento:** Úsala para responder preguntas sobre precios, cobertura, etc.
                * **Manejo de Desvíos:** Si el usuario pregunta algo fuera de contexto, responde brevemente y redirige.
                * **Adaptabilidad:** Si el usuario da varios datos a la vez, agradécele y pide el dato que te falte.
                `;

                // El resto de la función (payload, etc.) se mantiene igual
                const payload = {
                    contents: conversationHistory,
                    system_instruction: { parts: [{ text: systemInstructionText }] },
                    generationConfig: { temperature: 0.5, topP: 1, maxOutputTokens: 150 }
                };
                return await callGemini(payload);
            }

            const emergencyBtn = document.getElementById('emergency-btn');
            const scheduleBtn = document.getElementById('schedule-btn');
            const initialButtonsContainer = document.getElementById('initial-buttons-container');
            const chatFormContainer = document.getElementById('chat-form'); // Asume que tu form tiene este ID

            function startConversation(flowType) {
                // Ocultar botones
                initialButtonsContainer.style.display = 'none';

                // Mostrar el formulario de input
                chatFormContainer.style.display = 'flex';

                let firstBotMessage = '';
                let userChoiceMessage = '';

                if (flowType === 'emergency') {
                    userChoiceMessage = "Tengo una Emergencia";
                    firstBotMessage = "Entendido. Para enviar un técnico ya, ¿cuál es su teléfono?";
                } else {
                    userChoiceMessage = "Quiero Agendar una Visita";
                    firstBotMessage = "Excelente. Para que el técnico vaya preparado, descríbame brevemente el problema.";
                }

                // Añadir la elección del usuario al historial y a la pantalla
                appendMessage(userChoiceMessage, 'user');
                conversationHistory.push({ role: 'user', parts: [{ text: userChoiceMessage }] });

                // Añadir la primera respuesta del bot y al historial
                setTimeout(() => {
                    appendMessage(firstBotMessage, 'bot');
                    conversationHistory.push({ role: 'model', parts: [{ text: firstBotMessage }] });
                    userInput.focus();
                }, 500); // Pequeño delay para que se sienta natural
            }

            emergencyBtn.addEventListener('click', () => startConversation('emergency'));
            scheduleBtn.addEventListener('click', () => startConversation('schedule'));

            // Ocultar el formulario de input al inicio
            chatFormContainer.style.display = 'none';

            async function triggerSummaryGeneration(flowType) { // 1. Acepta el tipo de flujo
                appendMessage('<strong>Enviando alerta al equipo técnico...</strong>', 'system', 'summary');

                let summaryPrompt = '';
                // 2. Elige el prompt correcto según el flujo
                if (flowType === 'emergency') {
                    summaryPrompt = `Crea un SMS de alerta URGENTE para un técnico de destapes. Resume la conversación y formatea así: "NUEVO DESTAPE URGENTE. Cliente: [Nombre]. Teléfono: [Número]. Dirección: [Dirección si la hay]. Contactar AHORA.". Historial: ${JSON.stringify(conversationHistory)}`;
                } else { // 'schedule'
                    summaryPrompt = `Crea un SMS informativo para agendamiento. Resume la conversación y formatea así: "NUEVA VISITA AGENDADA. Cliente: [Nombre]. Teléfono: [Número]. Dirección: [Dirección]. Problema: [Descripción]. Horario: [Día y Hora]. Confirmar con cliente.". Historial: ${JSON.stringify(conversationHistory)}`;
                }

                const payload = { contents: [{ role: 'user', parts: [{ text: summaryPrompt }] }] };

                try {
                    console.log(`FRONTEND: Generando resumen para ${flowType}...`);
                    const summaryResponse = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!summaryResponse.ok) throw new Error('Error al generar resumen');
                    
                    const result = await summaryResponse.json();
                    const summaryText = result.candidates[0].content.parts[0].text;
                    const phoneMatch = summaryText.match(/Teléfono:\s*([\d\s\+]+)/);
                    const leadPhone = phoneMatch ? phoneMatch[1].trim() : 'Teléfono no capturado';
                    
                    const dataToSend = { 
                        summaryText: summaryText, 
                        leadEmail: leadPhone,
                        flowType: flowType // 3. Envía el tipo de flujo al backend
                    };
                    
                    console.log('FRONTEND: Enviando este objeto a /api/send-summary:', JSON.stringify(dataToSend, null, 2));

                    await fetch('/api/send-summary', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataToSend),
                    });
                    
                    appendMessage("<strong>✓ Alerta enviada.</strong><p>Gracias por contactarnos.</p>", 'system', 'summary');
                } catch (error) {
                    console.error("Error en el proceso de resumen y envío:", error);
                    appendMessage("Error al procesar la solicitud. Por favor, contacte a soporte.", 'system', 'summary');
                }
            }
        });
    </script>
</body>

</html> 